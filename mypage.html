<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ë‚´ í”„ë¡œí•„ - Fooding</title>
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap"
    />
    <link rel="stylesheet" href="common.css" />
    <link rel="stylesheet" href="mypage.css" />
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  </head>
  <body>
    <header>
      <!-- ë„¤ë¹„ê²Œì´ì…˜ ë°”ëŠ” JavaScriptë¡œ ì‚½ì…ë©ë‹ˆë‹¤ -->
    </header>

    <div class="profile-container">
      <div class="profile-box">
        <div class="profile-header">
          <h2>ë‚´ í”„ë¡œí•„</h2>
          <button class="back-btn" onclick="location.href='after_login.html'">
            ëŒì•„ê°€ê¸°
          </button>
        </div>
        <p class="subtitle">ë‚´ ì •ë³´ ë° ë“±ë¡í•œ ì‹ì¬ë£Œ</p>

        <div class="user-info">
          <div class="profile-img"></div>
          <div class="user-details" id="user-details">
            <p>ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
          </div>
        </div>

        <h3 class="section-title">ë“±ë¡ëœ ì‹ì¬ë£Œ</h3>
        <div id="ingredients-container">
          <p>ë“±ë¡ëœ ì‹ì¬ë£Œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        </div>

        <button
          class="new-register-btn"
          onclick="location.href='new-item.html'"
        >
          ìƒˆ ì‹ì¬ë£Œ ë“±ë¡í•˜ê¸°
        </button>
      </div>
    </div>

    <script src="navbar.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        // ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
        const userId = localStorage.getItem('userId');
        if (!userId) {
          // ë¡œê·¸ì¸ë˜ì§€ ì•Šì€ ê²½ìš° ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
          window.location.href = 'fooding_login.html';
          return;
        }

        const userDetailsEl = document.getElementById('user-details');
        const ingredientsContainerEl = document.getElementById(
          'ingredients-container'
        );

        // ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        axios
          .get(`https://3.37.172.142:8081/api/users/${userId}/username`)
          .then((response) => {
            const userName = response.data.userName;

            // ì„ì‹œë¡œ ì‚¬ìš©ì ì •ë³´ í‘œì‹œ (ì‹¤ì œë¡œëŠ” APIì—ì„œ ë” ë§ì€ ì •ë³´ë¥¼ ê°€ì ¸ì™€ì•¼ í•¨)
            userDetailsEl.innerHTML = `
            <strong>${userName}</strong>
            <p>ğŸ“ ì—°ë½ì²˜ ì •ë³´</p>
            <p>ğŸ“ ì§€ì—­ ì •ë³´</p>
          `;
          })
          .catch((error) => {
            console.error('ì‚¬ìš©ì ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤', error);
            userDetailsEl.innerHTML =
              '<p>ì‚¬ìš©ì ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</p>';
          });

        // ì‚¬ìš©ìì˜ ë“±ë¡ëœ ì‹ì¬ë£Œ ê°€ì ¸ì˜¤ê¸°
        axios
          .get(`https://3.37.172.142:8081/api/items/my?userId=${userId}`)
          .then((response) => {
            const items = response.data;

            if (items.length === 0) {
              ingredientsContainerEl.innerHTML =
                '<p>ë“±ë¡ëœ ì‹ì¬ë£Œê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
              return;
            }

            ingredientsContainerEl.innerHTML = '';

            // ìµœëŒ€ 3ê°œì˜ ì‹ì¬ë£Œë§Œ í‘œì‹œ
            const displayItems = items.slice(0, 3);

            displayItems.forEach((item) => {
              const itemElement = document.createElement('div');
              itemElement.className = 'ingredient-card';
              itemElement.innerHTML = `
              <div class="top-row">
                <strong>${item.itemName}</strong>
                <span class="weight">${item.quantity || 'ìˆ˜ëŸ‰ ì •ë³´ ì—†ìŒ'}</span>
              </div>
              <p class="date">ğŸ“… ìœ í†µê¸°í•œ: ${
                item.expirationDate || 'ì •ë³´ ì—†ìŒ'
              }</p>
              <p class="comment">â± ${
                item.itemDescription || 'ì¶”ê°€ ì„¤ëª… ì—†ìŒ'
              }</p>
            `;
              ingredientsContainerEl.appendChild(itemElement);
            });

            // ë” ë§ì€ ì‹ì¬ë£Œê°€ ìˆëŠ” ê²½ìš° ë©”ì‹œì§€ ì¶”ê°€
            if (items.length > 3) {
              const moreMessage = document.createElement('p');
              moreMessage.textContent = `ì™¸ ${
                items.length - 3
              }ê°œì˜ ì‹ì¬ë£Œê°€ ìˆìŠµë‹ˆë‹¤.`;
              moreMessage.style.textAlign = 'center';
              moreMessage.style.marginTop = '1rem';
              ingredientsContainerEl.appendChild(moreMessage);
            }
          })
          .catch((error) => {
            console.error('ì‹ì¬ë£Œ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤', error);
            ingredientsContainerEl.innerHTML =
              '<p>ë“±ë¡ëœ ì‹ì¬ë£Œë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</p>';
          });
      });
    </script>
  </body>
</html>
